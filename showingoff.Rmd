---
  title: Sankey from Scratch
author: Timely Portfolio
github: {user: timelyportfolio, repo: rCharts_d3_sankey, branch: "gh-pages"}
framework: bootstrap
mode: selfcontained
highlighter: prettify
hitheme: twitter-bootstrap
widgets: "d3_sankey"
assets:
  css:
  - "http://fonts.googleapis.com/css?family=Raleway:300"
- "http://fonts.googleapis.com/css?family=Oxygen"
---
  
<style>
  .container { width: 1000px; }

  body{
    font-family: 'Oxygen', sans-serif;
    font-size: 16px;
    line-height: 24px;
  }
  
  h1,h2,h3,h4 {
    font-family: 'Raleway', sans-serif;
  }
  
  h3 {
    background-color: #D4DAEC;
      text-indent: 100px; 
  }
  
  h4 {
    text-indent: 100px;
}
</style>
  
  <a href="https://github.com/timelyportfolio/rCharts_share"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
  
  ```{r echo=F, warning= F, message=F}
opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  tidy = FALSE,
  cache = FALSE,
  results = 'asis'
)
```
# Showing Off Your Beautiful rChart
Just like making [`rCharts`](http://rcharts.io/site) is [easy](http://ramnathv.github.io/rCharts/), showing off your beautiful creation is also super simple with lots of built in options.  We will look at each of these options and provide examples.  First let's grab some data.  For this example, we will get daily S&P 500 prices from [Yahoo! Finance](http://finance.yahoo.com/q?s=%5EGSPC) using `getSymbols` and then use `runMean` to calculate a 200 day simple moving average.

```{r}
require(quantmod)
require(reshape2)
require(rCharts)

#get sp500 prices from Yahoo! Finance
sp500 <- getSymbols("^GSPC", auto.assign = FALSE)
#add 200 day moving average
sp500$ma <- runMean( sp500[,4], n = 200)
#get date, close, and 200day mov avg as a data.frame
sp500.df <- data.frame(index(sp500),coredata(sp500)[,c(4,7)])
colnames(sp500.df) <- c("date","close","200dMovAvg")
#melt to long format
sp500.melt <- melt( sp500.df, id.vars = 1 )
#get dates to a javascript favorite format
sp500.melt$date <- as.numeric(as.POSIXct(sp500.melt$date)) * 1000
```

Now that we have some data, we can make a simple [NVD3](http://nvd3.org) [lineWithFocus chart](http://nvd3.org/ghpages/lineWithFocus.html) to use as our example.  

```{r}
#do a NVD3 lineWithFocus chart
n1 <- nPlot(
  value ~ date,
  group = "variable",
  data = sp500.melt,
  type = "lineWithFocusChart"
)
#set xAxis up to format dates
n1$xAxis(tickFormat = "#!function(d) {return d3.time.format('%b %d, %Y')(new Date(d))}!#")
#xAxis auto sets x2Axis, but I like a different format for x2Axis
n1$x2Axis(tickFormat = "#!function(d) {return d3.time.format('%Y')(new Date(d))}!#")
#set yAxis up to format numbers
n1$yAxis(tickFormat = "#!function(d) {return d3.format('0,.0')(d)}!#")
```